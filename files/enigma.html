<!DOCTYPE html>
<html ng-app="app" ng-controller="mainCtrl as m">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=0">
		<title>Enigma Machine</title>
		<link rel="stylesheet" href="../assets/standard-tool-css.css">
		<link rel="icon" href="https://static-s.aa-cdn.net/img/gp/20600005222152/5VqSpUgxQQkRTyPfatTm3KaVzOXzzFjnjEizGrrbot0fdM-arn7fM-_yKy3p98JxnQ=w300?v=1" type="image/png">
	</head>
	<body>
		<h1>𝕯𝖎𝖌𝖎𝖙𝖆𝖑 𝕰𝖓𝖎𝖌𝖒𝖆 𝕸𝖆𝖈𝖍𝖎𝖓𝖊</h1>

	<ul class="menu">
		<li ng-click="m.setMode(0)" ng-class="{active: m.encode}">𝕰𝖓𝖈𝖗𝖞𝖕𝖙 𝕸𝖊𝖘𝖘𝖆𝖌𝖊</li>
		<li ng-click="m.setMode(1)" ng-class="{active: !m.encode}">𝕯𝖊𝖈𝖗𝖞𝖕𝖙 𝕸𝖊𝖘𝖘𝖆𝖌𝖊</li>
	</ul>

  <h3>𝕴𝖓𝖕𝖚𝖙:</h3>
	<textarea name="input" placeholder="{{m.inputPlaceholder()}}" ng-model="m.input" ng-keyup="m.process()"></textarea>

  <h3>𝕺𝖚𝖙𝖕𝖚𝖙:</h3>
	<pre placeholder="{{m.outputPlaceholder()}}" ng-bind="m.output" id="output"></pre>
  <div class="block">
    <button ng-click="m.selectText()">𝕮𝖔𝖕𝖞 𝕺𝖚𝖙𝖕𝖚𝖙</button>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0/angular.min.js"></script>
  <script type="text/javascript">
    var app = angular.module('app', []);
    app.config(function($sceProvider) {
      $sceProvider.enabled(false);
    });
    app.controller('mainCtrl', ['$http', '$timeout', function ($http, $timeout) {
      var vm = this;
      vm.input = "";
      vm.output = "";
			vm.encode = true;
			vm.morseStr = "•••• • •-•• •-•• --- •-- --- •-• •-•• -••";
			vm.enStr = "Type a message that you wish to encrypt";
			vm.setMode = (mode)=>{
				vm.encode = !mode;
				if (/^[\w\s,?]+$/.test(vm.input) && mode == 1 || /^[-•\s]+$/.test(vm.input) && mode == 0) {
					vm.input = vm.output;
				}
				vm.process();
			};
			vm.inputPlaceholder = ()=>{
				return vm.encode ? vm.enStr : vm.morseStr;
			};
			vm.outputPlaceholder = ()=>{
				return vm.encode ? vm.morseStr : vm.enStr;
			};
      vm.process = function () {
        vm.output = vm.input.toUpperCase();
				if (vm.encode) {
					vm.output = vm.output.replace(/\s+/g, "	");
					vm.output = vm.output.replace(/[a-z0-9,?•]/gi, (match)=>{
						return " "+vm.code[match.toUpperCase()];
					});
				} else {
					vm.output = vm.output.replace(/(^[\.•-]+)|\s[\.•-]+/gi, (match)=>{
						match = match.replace(/\./g, "•");
						return vm.rcode[match.trim()] || match;
					})
					vm.output = vm.output.charAt(0).toUpperCase() + vm.output.slice(1).toLowerCase();
					vm.output = vm.output.replace(/\s+/g, " ");
				}
				vm.output = vm.output.trim();
      };
      vm.selectText = ()=>{
        var doc = document, text = doc.getElementById("output"), range, selection;
        if (doc.body.createTextRange) {
          range = document.body.createTextRange();
          range.moveToElementText(text);
          range.select();
        } else if (window.getSelection) {
          selection = window.getSelection();
          range = document.createRange();
          range.selectNodeContents(text);
          selection.removeAllRanges();
          selection.addRange(range);
        }
        try {
          document.execCommand('copy');
          $timeout(()=>{
            window.getSelection().removeAllRanges();
          }, 100);
        } catch (e) { console.warn("Error", e); }
      }
    }]);
  </script>
</body>
</html>
